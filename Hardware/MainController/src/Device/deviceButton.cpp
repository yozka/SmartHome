#include "deviceButton.h"
#include "../../user_config.h"


#include "../Board/board.h"

///--------------------------------------------------------------------------------------
using namespace Device;
///--------------------------------------------------------------------------------------







 ///=====================================================================================
///
/// возвратим имя
/// 
/// 
/// 
///--------------------------------------------------------------------------------------
String AButton::name() const
{
    return onName();
}
///--------------------------------------------------------------------------------------







 ///=====================================================================================
///
/// настройка
/// 
/// 
/// 
///--------------------------------------------------------------------------------------
void AButton::setup()
{
    onSetup();
}
///--------------------------------------------------------------------------------------





 ///=====================================================================================
///
/// обработать
/// нажатие кнопки, обрабатывается дребез контактов
/// 
/// 
///--------------------------------------------------------------------------------------
void AButton::update(const unsigned long &time)
{
    //hysteresis
    const bool pressed = onPressed();

    //первое нажатие на кнопку
    if (mChangeTime == 0 && pressed)
    {
        mChangeTime = time + Config::Button::timeHysteresisDown;

    }

    if (pressed)
    {
        if (!test)
        {
            auto r = Board::relays.findDevice(F("Relay01"));
            if (r)
            {
                r->turnOn();
            }
            test = true;
        }
    }
    else
    {
        if (test)
        {
            auto r = Board::relays.findDevice(F("Relay01"));
            if (r)
            {
                r->turnOff();
            }
            test = false;
        }
    }
}
///--------------------------------------------------------------------------------------



